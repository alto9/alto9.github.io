

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Local deployment &mdash; Peddler  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Kubernetes deployment" href="k8s.html" />
    <link rel="prev" title="Running OpenCart" href="run.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #009CEA" >
          

          
            <a href="index.html" class="icon icon-home"> Peddler
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">User guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="gettingstarted.html">Getting started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="run.html">Running OpenCart</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Local deployment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#main-commands">Main commands</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#all-in-one-command">All-in-one command</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#update-docker-images">Update docker images</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-opencart">Running OpenCart</a></li>
<li class="toctree-l4"><a class="reference internal" href="#service-initialisation">Service initialisation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#logging">Logging</a></li>
<li class="toctree-l4"><a class="reference internal" href="#docker-container-web-ui-with-portainer">Docker container web UI with Portainer</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#guides">Guides</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#running-opencart-behind-a-web-proxy">Running OpenCart behind a web proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-multiple-opencart-platforms-on-a-single-server">Running multiple OpenCart platforms on a single server</a></li>
<li class="toctree-l4"><a class="reference internal" href="#upgrading-from-earlier-versions">Upgrading from earlier versions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#backups-migrating-to-a-different-server">Backups/Migrating to a different server</a></li>
<li class="toctree-l4"><a class="reference internal" href="#making-database-dumps">Making database dumps</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="k8s.html">Kubernetes deployment</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration and customisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="peddler.html">Peddler development</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Peddler</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="run.html">Running OpenCart</a> &raquo;</li>
        
      <li>Local deployment</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/alto9/peddler/blob/master/docs/local.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="local-deployment">
<span id="local"></span><h1>Local deployment<a class="headerlink" href="#local-deployment" title="Permalink to this headline">¶</a></h1>
<p>This method is for deploying OpenCart locally on a single server, where docker images are orchestrated with <a class="reference external" href="https://docs.docker.com/compose/overview/">docker-compose</a>.</p>
<p>In the following, environment and data files will be generated in a user-specific project folder which will be referred to as the “<strong>project root</strong>”. On Linux, the default project root is <code class="docutils literal notranslate"><span class="pre">~/.local/share/peddler</span></code>. An alternative project root can be defined by passing the <code class="docutils literal notranslate"><span class="pre">--root=...</span></code> option to the <code class="docutils literal notranslate"><span class="pre">peddler</span></code> command, or defining the <code class="docutils literal notranslate"><span class="pre">PEDDLER_ROOT=...</span></code> environment variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">peddler</span> <span class="o">--</span><span class="n">root</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">peddlerroot</span> <span class="n">run</span> <span class="o">...</span>
<span class="c1"># Or equivalently:</span>
<span class="n">export</span> <span class="n">PEDDLER_ROOT</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">peddlerroot</span>
<span class="n">peddler</span> <span class="n">run</span> <span class="o">...</span>
</pre></div>
</div>
<section id="main-commands">
<h2>Main commands<a class="headerlink" href="#main-commands" title="Permalink to this headline">¶</a></h2>
<p>All available commands can be listed by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">peddler</span> <span class="n">local</span> <span class="n">help</span>
</pre></div>
</div>
<section id="all-in-one-command">
<h3>All-in-one command<a class="headerlink" href="#all-in-one-command" title="Permalink to this headline">¶</a></h3>
<p>A fully-functional platform can be configured and run in one command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">peddler</span> <span class="n">local</span> <span class="n">quickstart</span>
</pre></div>
</div>
<p>But you may want to run commands one at a time: it’s faster when you need to run only part of the local deployment process, and it helps you understand how your platform works. In the following we decompose the <code class="docutils literal notranslate"><span class="pre">quickstart</span></code> command.</p>
</section>
<section id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">peddler</span> <span class="n">config</span> <span class="n">save</span> <span class="o">--</span><span class="n">interactive</span>
</pre></div>
</div>
<p>This is the only non-automatic step in the installation process. You will be asked various questions about your OpenCart platform and appropriate configuration files will be generated. If you would like to automate this step then you should run <code class="docutils literal notranslate"><span class="pre">peddler</span> <span class="pre">config</span> <span class="pre">save</span> <span class="pre">--interactive</span></code> once. After that, there will be a <code class="docutils literal notranslate"><span class="pre">config.yml</span></code> file at the root of the project folder: this file contains all the configuration values for your platform, such as randomly generated passwords, domain names, etc.</p>
<p>If you want to run a fully automated installation, upload the <code class="docutils literal notranslate"><span class="pre">config.yml</span></code> file to wherever you want to run OpenCart. You can then entirely skip the configuration step.</p>
</section>
<section id="update-docker-images">
<h3>Update docker images<a class="headerlink" href="#update-docker-images" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">peddler</span> <span class="n">local</span> <span class="n">dc</span> <span class="n">pull</span>
</pre></div>
</div>
<p>This downloads the latest version of the Docker images from <a class="reference external" href="https://hub.docker.com/r/alto9/opencart/">Docker Hub</a>. Depending on your bandwidth, this might take a long time. Minor image updates will be incremental, and thus much faster.</p>
</section>
<section id="running-opencart">
<h3>Running OpenCart<a class="headerlink" href="#running-opencart" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">peddler</span> <span class="n">local</span> <span class="n">start</span>
</pre></div>
</div>
<p>This will launch the various docker containers required for your OpenCart platform. The store and admin will then be reachable at the domain name you specified during the configuration step.</p>
<p>To stop the running containers, just hit Ctrl+C.</p>
<p>In production, you will probably want to daemonize the services. To do so, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">peddler</span> <span class="n">local</span> <span class="n">start</span> <span class="o">--</span><span class="n">detach</span>
</pre></div>
</div>
<p>And then, to stop all services:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">peddler</span> <span class="n">local</span> <span class="n">stop</span>
</pre></div>
</div>
</section>
<section id="service-initialisation">
<h3>Service initialisation<a class="headerlink" href="#service-initialisation" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">peddler</span> <span class="n">local</span> <span class="n">init</span>
</pre></div>
</div>
<p>This command should be run just once. It will initialise all applications in a running platform. In particular, this will create the required databases tables and apply database migrations for all applications.</p>
<p>If initialisation is stopped with a <code class="docutils literal notranslate"><span class="pre">Killed</span></code> message, this certainly means the docker containers don’t have enough RAM. See the <a class="reference internal" href="troubleshooting.html#troubleshooting"><span class="std std-ref">Troubleshooting</span></a> section.</p>
</section>
<section id="logging">
<h3>Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h3>
<p>By default, logs from all containers are forwarded to the <a class="reference external" href="https://docs.docker.com/config/containers/logging/configure/">default Docker logging driver</a>: this means that logs are printed to the standard output when running in non-daemon mode (<code class="docutils literal notranslate"><span class="pre">peddler</span> <span class="pre">local</span> <span class="pre">start</span></code>). In daemon mode, logs can still be accessed with <code class="docutils literal notranslate"><span class="pre">peddler</span> <span class="pre">local</span> <span class="pre">logs</span></code> commands (see <a class="reference internal" href="troubleshooting.html#logging"><span class="std std-ref">logging</span></a>).</p>
</section>
<section id="docker-container-web-ui-with-portainer">
<span id="portainer"></span><h3>Docker container web UI with <a class="reference external" href="https://portainer.io/">Portainer</a><a class="headerlink" href="#docker-container-web-ui-with-portainer" title="Permalink to this headline">¶</a></h3>
<p>Portainer is a web UI for managing docker containers. It lets you view your entire OpenCart platform at a glace. Try it! It’s really cool:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">rm</span> \
    <span class="o">--</span><span class="n">volume</span><span class="o">=/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">docker</span><span class="o">.</span><span class="n">sock</span><span class="p">:</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">docker</span><span class="o">.</span><span class="n">sock</span> \
    <span class="o">--</span><span class="n">volume</span><span class="o">=/</span><span class="n">tmp</span><span class="o">/</span><span class="n">portainer</span><span class="p">:</span><span class="o">/</span><span class="n">data</span> \
    <span class="o">-</span><span class="n">p</span> <span class="mi">9000</span><span class="p">:</span><span class="mi">9000</span> \
    <span class="n">portainer</span><span class="o">/</span><span class="n">portainer</span><span class="p">:</span><span class="n">latest</span> <span class="o">--</span><span class="n">bind</span><span class="o">=</span><span class="p">:</span><span class="mi">9000</span>
</pre></div>
</div>
<p>You can then view the portainer UI at <a class="reference external" href="http://localhost:9000">http://localhost:9000</a>. You will be asked to define a password for the admin user. Then, select a “Local environment” to work on; hit “Connect” and select the “local” group to view all running containers.</p>
<p>Among many other things, you’ll be able to view the logs for each container, which is really useful.</p>
</section>
</section>
<section id="guides">
<h2>Guides<a class="headerlink" href="#guides" title="Permalink to this headline">¶</a></h2>
<section id="running-opencart-behind-a-web-proxy">
<span id="web-proxy"></span><h3>Running OpenCart behind a web proxy<a class="headerlink" href="#running-opencart-behind-a-web-proxy" title="Permalink to this headline">¶</a></h3>
<p>The containerized web server ([Caddy](caddyserver.com/)) needs to listen to ports 80 and 443 on the host. If there is already a webserver running on the host, such as Apache or Nginx, the caddy container will not be able to start. Peddler supports running behind a web proxy. To do so, add the following configuration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">peddler</span> <span class="n">config</span> <span class="n">save</span> <span class="o">--</span><span class="nb">set</span> <span class="n">RUN_CADDY</span><span class="o">=</span><span class="n">false</span> <span class="o">--</span><span class="nb">set</span> <span class="n">NGINX_HTTP_PORT</span><span class="o">=</span><span class="mi">81</span>
</pre></div>
</div>
<p>In this example, the nginx container port would be mapped to 81 instead of 80. You must then configure the web proxy on the host. As of v11.0.0, configuration files are no longer provided for automatic configuration of your web proxy. Basically, you should setup a reverse proxy to <cite>localhost:NGINX_HTTP_PORT</cite> from the STORE_HOST, as well as any additional host exposed by your plugins.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In this setup, the Nginx HTTP port will be exposed to the world. Make sure to configure your server firewall to block unwanted connections to your server’s <cite>NGINX_HTTP_PORT</cite>. Alternatively, you can configure the Nginx container to accept only local connections:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">peddler</span> <span class="n">config</span> <span class="n">save</span> <span class="o">--</span><span class="nb">set</span> <span class="n">NGINX_HTTP_PORT</span><span class="o">=</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">81</span>
</pre></div>
</div>
</div>
</section>
<section id="running-multiple-opencart-platforms-on-a-single-server">
<h3>Running multiple OpenCart platforms on a single server<a class="headerlink" href="#running-multiple-opencart-platforms-on-a-single-server" title="Permalink to this headline">¶</a></h3>
<p>With Peddler, it is easy to run multiple OpenCart instances on a single server. To do so, the following configuration parameters must be different for all platforms:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PEDDLER_ROOT</span></code>: so that configuration, environment and data are not mixed up between platforms.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LOCAL_PROJECT_NAME</span></code>: the various docker-compose projects cannot share the same name.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NGINX_HTTP_PORT</span></code>: ports cannot be shared by two different containers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">STORE_HOST</span></code>: the different platforms must be accessible from different domain (or subdomain) names.</p></li>
</ul>
<p>In addition, a web proxy must be setup on the host, as described <a class="reference internal" href="#web-proxy"><span class="std std-ref">above</span></a>.</p>
</section>
<section id="upgrading-from-earlier-versions">
<h3>Upgrading from earlier versions<a class="headerlink" href="#upgrading-from-earlier-versions" title="Permalink to this headline">¶</a></h3>
<section id="upgrading-peddler">
<h4>Upgrading Peddler<a class="headerlink" href="#upgrading-peddler" title="Permalink to this headline">¶</a></h4>
<p>Just upgrade Peddler using your <a class="reference internal" href="install.html#install"><span class="std std-ref">favorite installation method</span></a> and run quickstart again:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">peddler</span> <span class="n">local</span> <span class="n">quickstart</span>
</pre></div>
</div>
</section>
</section>
<section id="backups-migrating-to-a-different-server">
<h3>Backups/Migrating to a different server<a class="headerlink" href="#backups-migrating-to-a-different-server" title="Permalink to this headline">¶</a></h3>
<p>With Peddler, all data are stored in a single folder. This means that it’s extremely easy to migrate an existing platform to a different server. For instance, it’s possible to configure a platform locally on a laptop, and then move this platform to a production server.</p>
<ol class="arabic">
<li><p>Make sure <cite>peddler</cite> is installed on both servers with the same version.</p></li>
<li><p>Stop any running platform on server 1:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">peddler</span> <span class="n">local</span> <span class="n">stop</span>
</pre></div>
</div>
</li>
<li><p>Transfer the configuration, environment and platform data from server 1 to server 2:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rsync</span> <span class="o">-</span><span class="n">avr</span> <span class="s2">&quot;$(peddler config printroot)/&quot;</span> <span class="n">username</span><span class="nd">@server2</span><span class="p">:</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">peddler</span><span class="o">/</span>
</pre></div>
</div>
</li>
<li><p>On server 2, move the data to the right location:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mv</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">peddler</span> <span class="s2">&quot;$(peddler config printroot)&quot;</span>
</pre></div>
</div>
</li>
<li><p>Start the instance with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">peddler</span> <span class="n">local</span> <span class="n">start</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="making-database-dumps">
<h3>Making database dumps<a class="headerlink" href="#making-database-dumps" title="Permalink to this headline">¶</a></h3>
<p>To dump all data from the MySQL database used on the platform, run the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">peddler</span> <span class="n">local</span> <span class="n">exec</span> <span class="o">-</span><span class="n">e</span> <span class="n">MYSQL_ROOT_PASSWORD</span><span class="o">=</span><span class="s2">&quot;$(peddler config printvalue MYSQL_ROOT_PASSWORD)&quot;</span> <span class="n">mysql</span> \
    <span class="n">sh</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;mysqldump --all-databases --password=$MYSQL_ROOT_PASSWORD &gt; /var/lib/mysql/dump.sql&#39;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">dump.sql</span></code> file will be located in <code class="docutils literal notranslate"><span class="pre">$(peddler</span> <span class="pre">config</span> <span class="pre">printroot)/data/mysql</span></code>.</p>
</section>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="k8s.html" class="btn btn-neutral float-right" title="Kubernetes deployment" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="run.html" class="btn btn-neutral float-left" title="Running OpenCart" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>